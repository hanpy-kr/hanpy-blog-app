---
deployment: true
category: Backend
title: 'RedLock: Redis κΈ°λ° λ¶„μ‚° λ½ κµ¬ν„κ³Ό μ‹¤λ¬΄ μ μ©'
summary: 'RedLockμ€ Redisλ¥Ό μ΄μ©ν• λ¶„μ‚° λ½ μ•κ³ λ¦¬μ¦μΌλ΅, λ¶„μ‚° ν™κ²½μ—μ„ μ•μ „ν• λ½μ„ λ³΄μ¥ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤. λ³Έ κΈ€μ—μ„λ” RedLockμ μ›λ¦¬, κµ¬ν„ λ°©λ²•, μ‹¤λ¬΄ μ μ© μ‹ κ³ λ ¤ν•΄μ•Ό ν•  μ μ„ μ„¤λ…ν•©λ‹λ‹¤.'
pageKey: redis_redlock_implementation
lng: KOR
publishedAt: 2025-04-12
---

# RedLock: Redis κΈ°λ° λ¶„μ‚° λ½ κµ¬ν„κ³Ό μ‹¤λ¬΄ μ μ©

## 1. λ¶„μ‚° ν™κ²½μ—μ„μ λ½ λ¬Έμ 

λ¶„μ‚° μ‹μ¤ν…μ„ μ΄μν•λ‹¤ λ³΄λ©΄ **μ—¬λ¬ κ°μ λ…Έλ“κ°€ λ™μΌν• μμ›μ— μ ‘κ·Ό**ν•λ” μƒν™©μ΄ λ°μƒν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μ‡Όν•‘λ°μ—μ„ ν•μ • μλ‰μ μƒν’μ„ μ£Όλ¬Έν•  λ•, μ—¬λ¬ μ„λ²„μ—μ„ λ™μ‹μ— μ¬κ³ λ¥Ό μ°¨κ°ν•λ©΄ λ°μ΄ν„° λ¶μΌμΉκ°€ λ°μƒν•  μ μμµλ‹λ‹¤.

<br />

μ΄λ¥Ό λ°©μ§€ν•κΈ° μ„ν•΄ **λ¶„μ‚° λ½(Distributed Lock)**μ΄ ν•„μ”ν•©λ‹λ‹¤. Redisλ” κΈ°λ³Έμ μΌλ΅ **SET NX**(Not Exists)μ™€ **EX**(Expire) μµμ…μ„ μ΄μ©ν•μ—¬ **λ‹¨μΌ λ…Έλ“ ν™κ²½μ—μ„λ” λ½μ„ μ‰½κ² κµ¬ν„ν•  μ μμ§€λ§**, λ‹¤μ¤‘ λ…Έλ“ ν™κ²½μ—μ„λ” λ‹¨μν• λ½μΌλ΅λ” μ—¬λ¬ μ¥μ•  μƒν™©(λ„¤νΈμ›ν¬ λ¶„ν• , λ…Έλ“ μ¥μ•  λ“±)μ— μ·¨μ•½ν•  μ μμµλ‹λ‹¤.

<br />

μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ“±μ¥ν• μ•κ³ λ¦¬μ¦μ΄ **RedLock**μ…λ‹λ‹¤.

---

## 2. RedLockμ΄λ€?

**RedLock**μ€ Redisλ¥Ό ν™μ©ν•μ—¬ **λ¶„μ‚° ν™κ²½μ—μ„ κ°•λ ¥ν• λ½μ„ μ κ³µ**ν•κΈ° μ„ν• μ•κ³ λ¦¬μ¦μ…λ‹λ‹¤. Redisμ μ°½μ‹μμΈ **Salvatore Sanfilippo**κ°€ μ μ•ν–μΌλ©°, λ‹¤μ¤‘ Redis λ…Έλ“λ¥Ό ν™μ©ν•μ—¬ **λ†’μ€ κ°€μ©μ„±κ³Ό μ•μ •μ„±μ„ λ³΄μ¥ν•λ” λ½ μ‹μ¤ν…**μ„ κµ¬μ¶•ν•  μ μμµλ‹λ‹¤.

### **RedLockμ ν•µμ‹¬ κ°λ…**

- **λ‹¤μ¤‘ Redis λ…Έλ“(3~5κ°)μ—μ„ λ½μ„ νλ“ν•μ—¬ λ¶„μ‚° ν™κ²½μ—μ„λ„ λ™κΈ°ν™” λ³΄μ¥**
- **κ³Όλ°μ μ΄μƒμ λ…Έλ“μ—μ„ λ½μ„ νλ“ν•΄μ•Ό μ ν¨ν• λ½μΌλ΅ κ°„μ£Ό**
- **λ…Έλ“ μ¥μ• (Network Partition, Redis Crash) μƒν™©μ—μ„λ„ λ™μ‘ κ°€λ¥**

μ¦‰, **μΌλ¶€ Redis λ…Έλ“κ°€ λ‹¤μ΄λλ”λΌλ„ μ‹μ¤ν… μ „μ²΄κ°€ λ½μ„ μ μ§€ν•  μ μλ„λ΅ μ„¤κ³„**λ μ•κ³ λ¦¬μ¦μ…λ‹λ‹¤.

---

## 3. RedLockμ λ™μ‘ μ›λ¦¬

RedLockμ€ **5κ°μ Redis λ…Έλ“(μΌλ°μ μΌλ΅ 3κ°~5κ°)λ¥Ό μ‚¬μ©ν•μ—¬ λ½μ„ κ΄€λ¦¬**ν•©λ‹λ‹¤.  
λ½μ„ νλ“ν•λ” κ³Όμ •μ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

### ** Step 1. κ° Redis λ…Έλ“μ—μ„ λ½ μ‹λ„**

- ν΄λΌμ΄μ–ΈνΈκ°€ **κ° Redis λ…Έλ“μ— κ°™μ€ ν‚¤λ¥Ό **SET NX PX** λ…λ Ήμ–΄**λ΅ λ½μ„ μ‹λ„ν•©λ‹λ‹¤.
- **SET NX PX** λ…λ Ήμ–΄λ” λ½μ΄ μ—†μ„ κ²½μ°μ—λ§ μ„¤μ •ν•λ©°, μΌμ • μ‹κ°„μ΄ μ§€λ‚λ©΄ μλ™μΌλ΅ ν•΄μ λ©λ‹λ‹¤.

```sh title="redlock" showLineNumbers
SET my_lock_key random_token NX PX 10000
```

- my_lock_key: λ½μ ν‚¤
- random_token: ν΄λΌμ΄μ–ΈνΈκ°€ μƒμ„±ν• κ³ μ ν• κ°’ (λ½ μ†μ κ¶ ν™•μΈμ©)
- NX: ν‚¤κ°€ μ΅΄μ¬ν•μ§€ μ•μ„ λ•λ§ μ„¤μ •
- PX 10000: 10μ΄ ν›„ μλ™ ν•΄μ 

## ** Step 2. κ³Όλ°μ μ΄μƒμ Redis λ…Έλ“μ—μ„ λ½ νλ“ ν™•μΈ**

ν΄λΌμ΄μ–ΈνΈλ” λ½μ„ μ”μ²­ν• ν›„ μ‘λ‹µ μ‹κ°„μ„ κ³ λ ¤ν•μ—¬ λΉ λ¥΄κ² κ³Όλ°μ μ΄μƒμ λ…Έλ“μ—μ„ λ½μ΄ μ„¤μ •λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
λ³΄ν†µ 3κ°μ λ…Έλ“ μ΄μƒμ—μ„ λ½μ΄ μ„¤μ •λλ©΄ μ ν¨ν• λ½μΌλ΅ κ°„μ£Όν•©λ‹λ‹¤.
λ„¤νΈμ›ν¬ μ§€μ—°μ„ λ°©μ§€ν•κΈ° μ„ν•΄ νƒ€μ„μ•„μ›ƒ(λ½ μ”μ²­ μ΄ μ‹κ°„)μ€ TTL(λ½ λ§λ£ μ‹κ°„)μ μ λ° μ΄ν•λ΅ μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤.

## ** Step 3. λ½μ΄ μ ν¨ν•μ§€ ν™•μΈ ν›„ μ‘μ—… μν–‰**

κ³Όλ°μ μ΄μƒμ λ…Έλ“μ—μ„ λ½μ„ νλ“ν–λ‹¤λ©΄, μ‘μ—…(μ: DB μ—…λ°μ΄νΈ, νμΌ μμ • λ“±)μ„ μ•μ „ν•κ² μ‹¤ν–‰ν•©λ‹λ‹¤.

## ** Step 4. λ½ ν•΄μ **

μ‘μ—…μ΄ λλ‚λ©΄ κ° Redis λ…Έλ“μ—μ„ λ½μ„ ν•΄μ ν•©λ‹λ‹¤.
λ½μ„ μ„¤μ •ν•  λ• μ €μ¥ν• λλ¤ ν† ν°μ„ λΉ„κµν•μ—¬ ν•΄λ‹Ή ν΄λΌμ΄μ–ΈνΈλ§ λ½μ„ ν•΄μ ν•  μ μλ„λ΅ λ³΄μ¥ν•©λ‹λ‹¤.

```sh title="redlock" showLineNumbers
if redis.call("GET", my_lock_key) == random_token then
  redis.call("DEL", my_lock_key)
end
```

λ½μ„ μ„¤μ •ν• ν΄λΌμ΄μ–ΈνΈλ§ ν•΄λ‹Ή ν‚¤λ¥Ό μ‚­μ ν•  μ μλ„λ΅ κ²€μ¦ν•λ” κ³Όμ •μ΄ μ¤‘μ”ν•©λ‹λ‹¤.

---

## 4. RedLockμ κµ¬ν„ μμ 

### Node.js + Redisλ¥Ό ν™μ©ν• RedLock κµ¬ν„

```
import { createClient } from "redis";
import Redlock from "redlock";

// 1. Redis ν΄λΌμ΄μ–ΈνΈ 3κ° μƒμ„±
const redisClients = [
  createClient({ url: "redis://localhost:6379" }),
  createClient({ url: "redis://localhost:6380" }),
  createClient({ url: "redis://localhost:6381" }),
];

redisClients.forEach(client => client.connect());

// 2. Redlock μΈμ¤ν„΄μ¤ μƒμ„±
const redlock = new Redlock(redisClients, {
  driftFactor: 0.01, // ν΄λ­ λ“λ¦¬ν”„νΈ λ³΄μ •
  retryCount: 5, // μ¬μ‹λ„ νμ
  retryDelay: 200, // μ¬μ‹λ„ κ°„κ²© (ms)
});

// 3. λ½ νλ“ λ° ν•΄μ 
async function criticalSection() {
  try {
    // λ½ νλ“ (TTL 10μ΄)
    const lock = await redlock.acquire(["resource_key"], 10000);
    console.log("λ½ νλ“ μ„±κ³µ!");

    // μ¤‘μ”ν• μ‘μ—… μν–‰
    await new Promise(resolve => setTimeout(resolve, 5000));

    // λ½ ν•΄μ 
    await redlock.release(lock);
    console.log("λ½ ν•΄μ  μ™„λ£!");
  } catch (err) {
    console.error("λ½ νλ“ μ‹¤ν¨:", err);
  }
}

// μ‹¤ν–‰
criticalSection();
```

## 5. μ‹¤λ¬΄ μ μ© μ‹ κ³ λ ¤ν•  μ 

1οΈβƒ£ λ½μ„ λ¬΄μ΅°κ±΄μ μΌλ΅ μ‹ λΆ°ν•λ©΄ μ• λ¨

λ„¤νΈμ›ν¬ μ¥μ• λ‚ Redis μ„λ²„ λ‹¤μ΄μΌλ΅ μΈν•΄ μΌλ¶€ λ…Έλ“μ—μ„ λ½μ΄ μ μ§€λ  κ°€λ¥μ„±μ΄ μμ.
μ‘μ—…μ„ μν–‰ν•κΈ° μ „μ— λ½μ„ λ‹¤μ‹ ν• λ² ν™•μΈν•λ” λ΅μ§μ΄ ν•„μ”.

2οΈβƒ£ TTL μ„¤μ • μ£Όμ

λ½μ„ λ„λ¬΄ μ§§κ² μ„¤μ •ν•λ©΄, μ‘μ—…μ΄ μ™„λ£λκΈ° μ „μ— λ½μ΄ ν•΄μ λ  κ°€λ¥μ„±μ΄ μμ.
λ°λ€λ΅ λ„λ¬΄ κΈΈλ©΄, μ¥μ•  λ°μƒ μ‹ λ‹¤λ¥Έ ν”„λ΅μ„Έμ¤κ°€ λ½μ„ μ–»μ§€ λ»ν•  μλ„ μμ.

3οΈβƒ£ λΉ„μ¦λ‹μ¤ λ΅μ§κ³Ό μ—°κ³„

λ½ ν•΄μ  μ „μ— μ‹μ¤ν… μ¥μ• κ°€ λ°μƒν•  κ²½μ°, λ½μ΄ μ μ§€λ  μ μμ.
λ½μ΄ λ§λ£λμ—λ”μ§€ μ£ΌκΈ°μ μΌλ΅ ν™•μΈν•λ” λ©”μ»¤λ‹μ¦μ„ μ¶”κ°€ν•΄μ•Ό ν•¨.

6. κ²°λ΅ 
   RedLockμ€ Redisλ¥Ό ν™μ©ν• κ°•λ ¥ν• λ¶„μ‚° λ½ κΈ°λ²•μΌλ΅, λ‹¤μ¤‘ λ…Έλ“ ν™κ²½μ—μ„ λ°μ΄ν„° μ •ν•©μ„±μ„ λ³΄μ¥ν•©λ‹λ‹¤.
   κ³Όλ°μ μ΄μƒμ Redis λ…Έλ“μ—μ„ λ½μ„ νλ“ν•΄μ•Ό μ ν¨ν• λ½μΌλ΅ κ°„μ£Όν•μ—¬, λ„¤νΈμ›ν¬ μ¥μ• μ—λ„ μ•μ „μ„±μ„ μ μ§€ν•  μ μμµλ‹λ‹¤.
   μ‹¤λ¬΄ μ μ© μ‹ TTL μ„¤μ •, λ½ κ²€μ¦, μ¥μ•  λ°μƒ μ‹μ λ€μ‘ μ „λµμ„ μ‹ μ¤‘ν•κ² μ„¤κ³„ν•΄μ•Ό ν•©λ‹λ‹¤.
   RedLockμ„ μ¬λ°”λ¥΄κ² ν™μ©ν•λ©΄ κ³ μ„±λ¥ λ¶„μ‚° μ‹μ¤ν…μ—μ„λ„ μ•μ „ν• λ™μ‹μ„± μ μ–΄λ¥Ό κµ¬ν„ν•  μ μμµλ‹λ‹¤.
   μ΄λ¥Ό ν†µν•΄ λ°μ΄ν„° μ •ν•©μ„±μ„ μ μ§€ν•λ©΄μ„λ„ μ„λΉ„μ¤μ ν™•μ¥μ„±μ„ ν™•λ³΄ν•λ” κ²ƒμ΄ κ°€λ¥ν•©λ‹λ‹¤. π€

## μ°Έκ³ 

https://redis.io/docs/manual/patterns/distributed-locks/
